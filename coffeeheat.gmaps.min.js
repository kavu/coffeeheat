// Generated by CoffeeScript 1.3.3
((function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};(function(a){var c;return c=function(c){function d(a,b){var c=this;this.heatmap=null,this.conf=b,this.latlngs=[],this.bounds=null,this.setMap(a),google.maps.event.addListenerOnce(a,"idle",function(){return c.draw()})}return b(d,c),d.prototype.onAdd=function(){var a,b;return b=this.getMap().getDiv(),a=document.createElement("div"),a.style.position="absolute",a.style.top=a.style.border=a.style.left=0,a.style.width=b.clientWidth+"px",a.style.height=b.clientHeight+"px",this.getPanes().overlayLayer.appendChild(a),this.conf.element=a,this.heatmap=heatmapFactory.create(this.conf)},d.prototype.toggle=function(){return this.heatmap.toggleDisplay()},d.prototype.draw=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;h=this.getProjection(),a=this.map.getBounds();if(a.equals(this.bounds))return;this.bounds=a,g=h.fromLatLngToDivPixel(a.getNorthEast()),l=h.fromLatLngToDivPixel(a.getSouthWest()),m=g.y,e=l.x,this.conf.element.style.left=e+"px",this.conf.element.style.top=m+"px",this.conf.element.style.width=g.x-l.x+"px",this.conf.element.style.height=l.y-g.y+"px",this.heatmap.store.get("heatmap").resize();if(this.latlngs.length>0){this.heatmap.clear(),f=this.latlngs.length,i=this.getProjection(),b={max:this.heatmap.store.max,data:[]};while(f--){d=this.latlngs[f].latlng;if(!a.contains(d))continue;c=i.fromLatLngToDivPixel(d),k=new google.maps.Point(c.x-e,c.y-m),j=this.pixelTransform(k),b.data.push({x:j.x,y:j.y,count:this.latlngs[f].c})}return this.heatmap.store.setDataSet(b)}},d.prototype.pixelTransform=function(b){var c;a=this.heatmap.get("width"),c=this.heatmap.get("height");while(b.x<0)b.x+=a;while(b.x>a)b.x-=a;while(b.y<0)b.y+=c;while(b.y>c)b.y-=c;return b.x=b.x>>0,b.y=b.y>>0,b},d.prototype.setDataSet=function(a){var b,c,d,e,f,g;b=a.data,c=b.length,g=this.getProjection(),this.latlngs=[],e={max:a.max,data:[]};while(c--)d=new google.maps.LatLng(b[c].lat,b[c].lng),this.latlngs.push({latlng:d,c:b[c].count}),f=this.pixelTransform(g.fromLatLngToDivPixel(d)),e.data.push({x:f.x,y:f.y,count:b[c].count});return this.heatmap.clear(),this.heatmap.store.setDataSet(e)},d.prototype.addDataPoint=function(a,b,c){var d,e,f;return f=this.getProjection(),d=new google.maps.LatLng(a,b),e=this.pixelTransform(f.fromLatLngToDivPixel(d)),this.heatmap.store.addDataPoint(e.x,e.y,c),this.latlngs.push({latlng:d,c:c})},d}(google.maps.OverlayView),a.HeatmapOverlay=c})(window)})).call(this);