// Generated by CoffeeScript 1.3.3
((function(){(function(a){var b;return b=function(){var b,c;return c=function(){function a(a){var b;this.max=1,b={data:[],heatmap:a},this.get=function(a){return b[a]},this.set=function(a,c){b[a]=c}}return a.prototype.addDataPoint=function(a,b){var c,d,e,f;if(a<0||b<0)return;d=this.get("heatmap"),c=this.get("data"),c[a]||(c[a]=[]),c[a][b]||(c[a][b]=0),c[a][b]+=arguments.length<3?1:arguments[2],this.set("data",c);if(this.max<c[a][b]){this.max=c[a][b],d.get("actx").clearRect(0,0,d.get("width"),d.get("height"));for(e in c)for(f in c[e])d.drawAlpha(e,f,c[e][f]);return}d.drawAlpha(a,b,c[a][b])},a.prototype.setDataSet=function(a){var b,c,d,e,f;e=this.get("heatmap"),c=[],b=a.data,d=b.length,e.clear(),this.max=a.max;while(d--)f=b[d],e.drawAlpha(f.x,f.y,f.count),c[f.x]||(c[f.x]=[]),c[f.x][f.y]||(c[f.x][f.y]=0),c[f.x][f.y]=f.count;this.set("data",c)},a.prototype.exportDataSet=function(){var a,b,c,d;a=this.get("data"),b=[];for(c in a){if(c==="undefined")continue;for(d in a[c]){if(d==="undefined")continue;b.push({x:parseInt(c,10),y:parseInt(d,10),count:a[c][d]})}}return{max:this.max,data:b}},a.prototype.generateRandomDataSet=function(a){var b,c,d;c=this.get("heatmap"),d=Math.floor(Math.random()*1e3+1),b=[];while(a--)b.push({x:Math.floor(Math.random()*c.get("width")+1),y:Math.floor(Math.random()*c.get("height")+1),count:Math.floor(Math.random()*d+1)});this.setDataSet({max:d,data:b})},a}(),b=function(){function b(a){var b;b={radiusIn:20,radiusOut:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},visible:!0,width:0,height:0,max:!1,gradient:!1,opacity:180,premultiplyAlpha:!1,debug:!1},this.store=new c(this),this.get=function(a){return b[a]},this.set=function(a,c){b[a]=c},this.configure(a),this.init()}return b.prototype.configure=function(a){var b,c;a.radius&&(c=a.radius,b=parseInt(c/4,10)),this.set("radiusIn",b||15),this.set("radiusOut",c||40),this.set("element",a.element instanceof Object?a.element:document.getElementById(a.element)),this.set("visible",a.visible),this.set("max",a.max||!1),this.set("gradient",a.gradient||{.45:"rgb(0,0,255)",.55:"rgb(0,255,255)",.65:"rgb(0,255,0)",.95:"yellow",1:"rgb(255,0,0)"}),this.set("opacity",parseInt(255/(100/a.opacity),10)||180),this.set("width",a.width||0),this.set("height",a.height||0),this.set("debug",a.debug)},b.prototype.resize=function(){var a,b,c;c=this.get("element"),b=this.get("canvas"),a=this.get("acanvas"),b.width=a.width=c.style.width.replace(/px/,"")||this.getWidth(c),this.set("width",b.width),b.height=a.height=c.style.height.replace(/px/,"")||this.getHeight(c),this.set("height",b.height)},b.prototype.init=function(){var a,b,c;b=document.createElement("canvas"),a=document.createElement("canvas"),c=this.get("element"),this.initColorPalette(),this.set("canvas",b),this.set("acanvas",a),this.resize(),b.style.position=a.style.position="absolute",b.style.top=a.style.top="0",b.style.left=a.style.left="0",b.style.zIndex=1e6,this.get("visible")||(b.style.display="none"),this.get("element").appendChild(b),this.get("debug")&&document.body.appendChild(a),this.set("ctx",b.getContext("2d")),this.set("actx",a.getContext("2d"))},b.prototype.initColorPalette=function(){var a,b,c,d,e,f;a=document.createElement("canvas"),d=this.get("gradient"),a.width="1",a.height="256",b=a.getContext("2d"),c=b.createLinearGradient(0,0,1,256),e=b.getImageData(0,0,1,1),e.data[0]=e.data[3]=64,e.data[1]=e.data[2]=0,b.putImageData(e,0,0),e=b.getImageData(0,0,1,1),this.set("premultiplyAlpha",e.data[0]<60||e.data[0]>70);for(f in d)c.addColorStop(f,d[f]);b.fillStyle=c,b.fillRect(0,0,1,256),this.set("gradient",b.getImageData(0,0,1,256).data)},b.prototype.getWidth=function(a){var b;return b=a.offsetWidth,a.style.paddingLeft&&(b+=a.style.paddingLeft),a.style.paddingRight&&(b+=a.style.paddingRight),b},b.prototype.getHeight=function(a){var b;return b=a.offsetHeight,a.style.paddingTop&&(b+=a.style.paddingTop),a.style.paddingBottom&&(b+=a.style.paddingBottom),b},b.prototype.colorize=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;q=this.get("width"),p=this.get("radiusOut"),g=this.get("height"),c=this.get("actx"),e=this.get("ctx"),r=p*4,o=this.get("premultiplyAlpha"),n=this.get("gradient"),m=this.get("opacity"),a+r>q&&(a=q-r),a<0&&(a=0),b<0&&(b=0),b+r>g&&(b=g-r),i=c.getImageData(a,b,r,r),j=i.data,k=j.length,h=3;while(h<k){d=j[h],l=d*4;if(l==null)continue;f=d<m?d:m,j[h-3]=n[l],j[h-2]=n[l+1],j[h-1]=n[l+2],o&&(j[h-3]/=255/f,j[h-2]/=255/f,j[h-1]/=255/f),j[h]=f,h+=4}i.data=j,e.putImageData(i,a,b)},b.prototype.drawAlpha=function(a,b,c){var d,e;e=this.get("radiusOut"),d=this.get("actx"),d.shadowOffsetX=1e3,d.shadowOffsetY=1e3,d.shadowBlur=15,d.shadowColor="rgba(0,0,0,"+(c?c/this.store.max:"0.1")+")",d.fillStyle="rgba(0,0,0,1)",d.beginPath(),d.arc(a-1e3,b-1e3,e,0,Math.PI*2,!0),d.closePath(),d.fill(),this.colorize(a-2*e,b-2*e)},b.prototype.toggleDisplay=function(){var a,b;b=this.get("visible"),a=this.get("canvas"),b?a.style.display="none":a.style.display="block",this.set("visible",!b)},b.prototype.getImageData=function(){return this.get("canvas").toDataURL()},b.prototype.clear=function(){var b;a=this.get("width"),b=this.get("height"),this.store.set("data",[]),this.get("ctx").clearRect(0,0,a,b),this.get("actx").clearRect(0,0,a,b)},b.prototype.cleanup=function(){this.get("element").removeChild(this.get("canvas"))},b}(),{create:function(a){return new b(a)},util:{mousePosition:function(a){var b,c;a.layerX?(b=a.layerX,c=a.layerY):a.offsetX&&(b=a.offsetX,c=a.offsetY);if(b!=null)return[b,c]}}}}(),a.h337=a.heatmapFactory=b})(window)})).call(this);